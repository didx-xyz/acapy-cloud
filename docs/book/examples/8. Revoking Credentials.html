<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Revoking Credentials - DIDx-Cloud</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">DIDx-Cloud</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="8-revoking-credentials"><a class="header" href="#8-revoking-credentials">8: Revoking Credentials</a></h1>
<p>Revoking a credential can take one of two routes depending on the issuer's use case.</p>
<p>Depending on the frequency and volume of credential revocations, issuers may choose to batch publish
their revocations or not.
Since there is a cost associated with publishing revocations to the ledger,
it is recommended that issuers batch revocations when possible.</p>
<h2 id="automatic-publishing-of-revocations"><a class="header" href="#automatic-publishing-of-revocations">Automatic Publishing of Revocations</a></h2>
<blockquote>
<p>[!WARNING]
This endpoint should not be used to revoke more than one credential in quick succession.
For multiple revocations, follow the batching route.</p>
</blockquote>
<p>The fast and easy way to revoke a credential is to automatically publish the revocation to the ledger,
as shown in the example below.</p>
<pre><code class="language-http">POST /v1/issuer/credentials/revoke
</code></pre>
<pre><code class="language-json">{
  "credential_exchange_id": "v2-af4bad3f-3fcc-47ab-85e6-24224dcb2779",
  "credential_definition_id": "QrMaE11MnC6zjKNY1pxbq8:3:CL:8:Epic",
  "auto_publish_on_ledger": true
}
</code></pre>
<p>The endpoint will respond with:</p>
<pre><code class="language-json">{
  "cred_rev_ids_published": {
    "QrMaE11MnC6zjKNY1pxbq8:4:QrMaE11MnC6zjKNY1pxbq8:3:CL:8:Epic:CL_ACCUM:53462552-d716-4b0b-8b5c-914a3574d2c4": [2]
  }
}
</code></pre>
<p>The <code>"issuer_cred_rev"</code> event will fire again with the updated status <em>revoked</em>.</p>
<pre><code class="language-json">{
  "wallet_id": "5df42bab-6719-4c8a-a615-8086435d4de4",
  "topic": "issuer_cred_rev",
  "origin": "tenant faber",
  "group_id": "GroupA",
  "payload": {
    "created_at": "2024-04-30T08:51:18.177543Z",
    "cred_def_id": "QrMaE11MnC6zjKNY1pxbq8:3:CL:8:Epic",
    "cred_ex_id": "af4bad3f-3fcc-47ab-85e6-24224dcb2779",
    "cred_ex_version": "2",
    "cred_rev_id": "2",
    "record_id": "57bd9c72-fa29-4f65-bd89-4e241471073a",
    "rev_reg_id": "QrMaE11MnC6zjKNY1pxbq8:4:QrMaE11MnC6zjKNY1pxbq8:3:CL:8:Epic:CL_ACCUM:53462552-d716-4b0b-8b5c-914a3574d2c4",
    "state": "revoked",
    "updated_at": "2024-04-30T12:21:16.686124Z"
  }
}
</code></pre>
<p>The revocation status endpoint will also be updated to the new state.</p>
<pre><code class="language-http">GET /v1/issuer/credentials/revocation/record?credential_exchange_id=v2-af4bad3f-3fcc-47ab-85e6-24224dcb2779
</code></pre>
<pre><code class="language-json">{
  "created_at": "2024-04-30T08:51:18.177543Z",
  "cred_def_id": "QrMaE11MnC6zjKNY1pxbq8:3:CL:8:Epic",
  "cred_ex_id": "af4bad3f-3fcc-47ab-85e6-24224dcb2779",
  "cred_ex_version": "2",
  "cred_rev_id": "2",
  "record_id": "57bd9c72-fa29-4f65-bd89-4e241471073a",
  "rev_reg_id": "QrMaE11MnC6zjKNY1pxbq8:4:QrMaE11MnC6zjKNY1pxbq8:3:CL:8:Epic:CL_ACCUM:53462552-d716-4b0b-8b5c-914a3574d2c4",
  "state": "revoked",
  "updated_at": "2024-04-30T12:21:16.686124Z"
}
</code></pre>
<p>For emphasis: every credential revoked in this manner will trigger a ledger operation, which incurs a cost.
If an issuer has multiple credentials to revoke, it is recommended not to auto-publish to the ledger.</p>
<h2 id="manual-publishing-of-revocations-batching"><a class="header" href="#manual-publishing-of-revocations-batching">Manual Publishing of Revocations (Batching)</a></h2>
<p>By setting <code>"auto_publish_on_ledger"</code> to <em>false</em>, an issuer can call
revoke on all the <em>credential exchange ids</em> they would like to revoke without
performing multiple ledger operations.</p>
<pre><code class="language-http">POST /v1/issuer/credentials/revoke
</code></pre>
<pre><code class="language-json">{
  "credential_exchange_id": "v2-6dbfbeeb-468f-4017-93f7-09c3602b15d4",
  "credential_definition_id": "QrMaE11MnC6zjKNY1pxbq8:3:CL:8:Epic",
  "auto_publish_on_ledger": false
}
</code></pre>
<p>The endpoint will respond with:</p>
<pre><code class="language-json">{
  "cred_rev_ids_published": {}
}
</code></pre>
<p>However, the <code>"issuer_cred_rev"</code> event won't fire after every call as it does with <code>"auto_publish_on_ledger": true</code>,
because the credential's status will only update when the revocation has been published to the ledger.
This is also reflected in the revocation record, as the state remains <em>issued</em>.</p>
<pre><code class="language-http">GET /v1/issuer/credentials/revocation/record?credential_exchange_id=v2-6dbfbeeb-468f-4017-93f7-09c3602b15d4
</code></pre>
<pre><code class="language-json">{
  "created_at": "2024-04-30T12:49:25.210664Z",
  "cred_def_id": "QrMaE11MnC6zjKNY1pxbq8:3:CL:8:Epic",
  "cred_ex_id": "6dbfbeeb-468f-4017-93f7-09c3602b15d4",
  "cred_ex_version": "2",
  "cred_rev_id": "3",
  "record_id": "287a40fe-a23e-4675-b21f-5b72835b25be",
  "rev_reg_id": "QrMaE11MnC6zjKNY1pxbq8:4:QrMaE11MnC6zjKNY1pxbq8:3:CL:8:Epic:CL_ACCUM:53462552-d716-4b0b-8b5c-914a3574d2c4",
  "state": "issued",
  "updated_at": "2024-04-30T12:49:25.210664Z"
}
</code></pre>
<p>Once revocation is called on all the <em>credential exchange ids</em> that need to be revoked, the revocations can
then be published to the ledger.</p>
<p>Revocations that were called with <code>"auto_publish_on_ledger": false"</code> are pending publication.
An issuer can either publish these revocations or clear the revocation, i.e., not revoke the credential.</p>
<h3 id="publishing-pending-revocations"><a class="header" href="#publishing-pending-revocations">Publishing Pending Revocations</a></h3>
<p>The publish revocation endpoint can be used to publish revocations in bulk, or an issuer can be very specific
about which revocations they want to publish.</p>
<p>The body sent to the endpoint specifies what needs to be published.
This body is a revocation registry to credential map/dictionary.</p>
<p>Each key is a revocation registry ID (<code>rev_reg_id</code>), and its value is a list
of credential revocation IDs (<code>cred_rev_id</code>) to be published.
The payload below will publish 6 revocations across two registries.</p>
<pre><code class="language-http">POST /v1/issuer/credentials/publish-revocations
</code></pre>
<pre><code class="language-json">{
  "revocation_registry_credential_map": {
    "WWzcvsHULP1Fkf9GUYRZg8:4:WWzcvsHULP1Fkf9GUYRZg8:3:CL:8:Epic:CL_ACCUM:cd2e0473-31f7-4cde-883d-6fceac1ce0d7": [
      "1",
      "2",
      "3"
    ],
    "WWzcvsHULP1Fkf9GUYRZg8:4:WWzcvsHULP1Fkf9GUYRZg8:3:CL:8:Epic:CL_ACCUM:bf1219ca-75bf-4931-911b-1fe2ace39683": [
      "1",
      "2",
      "4"
    ]
  }
}
</code></pre>
<p>Providing an empty list for a registry ID instructs the system to publish all pending revocations for that ID.
The payload below will publish all pending revocations for the given registry ID (<code>rev_reg_id</code>).</p>
<pre><code class="language-http">POST /v1/issuer/credentials/publish-revocations
</code></pre>
<pre><code class="language-json">{
  "revocation_registry_credential_map": {
    "WWzcvsHULP1Fkf9GUYRZg8:4:WWzcvsHULP1Fkf9GUYRZg8:3:CL:8:Epic:CL_ACCUM:cd2e0473-31f7-4cde-883d-6fceac1ce0d7": []
  }
}
</code></pre>
<p>An empty map/dictionary signifies that all pending revocations across all registry IDs (belonging to the issuer)
should be published.</p>
<pre><code class="language-http">POST /v1/issuer/credentials/publish-revocations
</code></pre>
<pre><code class="language-json">{
  "revocation_registry_credential_map": {}
}
</code></pre>
<p>This endpoint responds with:</p>
<pre><code class="language-json">{
  "cred_rev_ids_published": {
    "rev_reg_id_1": [1, 2],
    "rev_reg_id_2": [0, 3]
  }
}
</code></pre>
<p>The <code>issuer_cred_rev</code> event will also fire for every credential that was revoked after the revocations were published.</p>
<h3 id="clearing-pending-revocations"><a class="header" href="#clearing-pending-revocations">Clearing Pending Revocations</a></h3>
<p>The clear revocation endpoint functions in the same way as the publish revocation endpoint. Instead of publishing
the revocations, it clears them, i.e., the credential is not revoked and is still considered valid.</p>
<p>The response to the clearing endpoint is also different from the publish endpoint. The clear pending revocation
endpoint responds with the <em>still</em> pending revocations.</p>
<p>The payload below will clear the pending revocation on <code>cred_rev_id = 5</code>.</p>
<pre><code class="language-http">POST /v1/issuer/credentials/clear-pending-revocations
</code></pre>
<pre><code class="language-json">{
  "revocation_registry_credential_map": {
    "CJnbcDL4vBkRzDSw5dS1Pa:4:CJnbcDL4vBkRzDSw5dS1Pa:3:CL:8:Epic:CL_ACCUM:55bd2b4c-672b-4749-b8d3-b1b8137d1012": ["5"]
  }
}
</code></pre>
<p>Response of still pending <code>cred_rev_ids</code> for the registry:</p>
<pre><code class="language-json">{
  "revocation_registry_credential_map": {
    "CJnbcDL4vBkRzDSw5dS1Pa:4:CJnbcDL4vBkRzDSw5dS1Pa:3:CL:8:Epic:CL_ACCUM:55bd2b4c-672b-4749-b8d3-b1b8137d1012": [
      "1",
      "2",
      "3",
      "4"
    ]
  }
}
</code></pre>
<p>This call will clear all pending revocations for the given registry ID.</p>
<pre><code class="language-http">POST /v1/issuer/credentials/clear-pending-revocations
</code></pre>
<pre><code class="language-json">{
  "revocation_registry_credential_map": {
    "CJnbcDL4vBkRzDSw5dS1Pa:4:CJnbcDL4vBkRzDSw5dS1Pa:3:CL:8:Epic:CL_ACCUM:55bd2b4c-672b-4749-b8d3-b1b8137d1012": []
  }
}
</code></pre>
<p>Response (no more pending revocations):</p>
<pre><code class="language-json">{
  "revocation_registry_credential_map": {}
}
</code></pre>
<p>This call will clear all revocations for all registries.</p>
<pre><code class="language-http">POST /v1/issuer/credentials/clear-pending-revocations
</code></pre>
<pre><code class="language-json">{
  "revocation_registry_credential_map": {}
}
</code></pre>
<p>Response (no more pending revocations):</p>
<pre><code class="language-json">{
  "revocation_registry_credential_map": {}
}
</code></pre>
<h3 id="getting-pending-revocations-per-revocation-registry"><a class="header" href="#getting-pending-revocations-per-revocation-registry">Getting Pending Revocations per Revocation Registry</a></h3>
<p>An issuer can get the pending revocations per revocation registry.</p>
<p>This is very easy to do; just call the following endpoint with the <code>rev_reg_id</code>:</p>
<pre><code class="language-http">GET /v1/issuer/credentials/get-pending-revocations/{revocation_registry_id}
</code></pre>
<p>Response:</p>
<pre><code class="language-json">{
  "pending_cred_rev_ids": [0, 1, 2, 3]
}
</code></pre>
<p>The response contains the integers of the <code>cred_rev_ids</code> that are pending revocation for the <code>rev_reg_id</code> called.</p>
<p>Next: <a href="9.%20Verify%20Revoked%20Credentials.html">Verifying Revoked Credentials</a></p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../examples/7. Verify Credential.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../examples/9. Verify Revoked Credentials.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../examples/7. Verify Credential.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../examples/9. Verify Revoked Credentials.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <!-- Livereload script (if served using the cli tool) -->
        <script>
            const wsProtocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsAddress = wsProtocol + "//" + location.host + "/" + "__livereload";
            const socket = new WebSocket(wsAddress);
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../mermaid.min.js"></script>
        <script src="../mermaid-init.js"></script>


    </div>
    </body>
</html>
