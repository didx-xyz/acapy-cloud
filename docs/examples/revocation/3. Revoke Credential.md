# Revoking Credentials

Revoking a credential can take one of two routes depending on the issuer's use case.

Depending on the amount or how regularly an issuer revokes a credentials they will batch publish their revokes or not.
Since there is a cost associated with publishing revocations to the ledger, it is recommended that an issuer batch revocations when possible.

## Auto Publish (Not batching)

The fast and easy way to revoke a credential is to auto publish the revocation to the ledger like the example below.

```http
POST /v1/issuer/credentials/revoke
```

```json
{
  "credential_exchange_id": "v2-af4bad3f-3fcc-47ab-85e6-24224dcb2779",
  "credential_definition_id": "QrMaE11MnC6zjKNY1pxbq8:3:CL:8:Epic",
  "auto_publish_on_ledger": true
}
```

The endpoint will respond with a ```204``` status code.

The ```"issuer_cred_rev"``` will fire again with the updated status *revoked*

```json
{
    "wallet_id": "5df42bab-6719-4c8a-a615-8086435d4de4",
    "topic": "issuer_cred_rev",
    "origin": "tenant faber",
    "group_id": "GroupA",
    "payload": {
      "created_at": "2024-04-30T08:51:18.177543Z",
      "cred_def_id": "QrMaE11MnC6zjKNY1pxbq8:3:CL:8:Epic",
      "cred_ex_id": "af4bad3f-3fcc-47ab-85e6-24224dcb2779",
      "cred_ex_version": "2",
      "cred_rev_id": "2",
      "record_id": "57bd9c72-fa29-4f65-bd89-4e241471073a",
      "rev_reg_id": "QrMaE11MnC6zjKNY1pxbq8:4:QrMaE11MnC6zjKNY1pxbq8:3:CL:8:Epic:CL_ACCUM:53462552-d716-4b0b-8b5c-914a3574d2c4",
      "state": "revoked",
      "updated_at": "2024-04-30T12:21:16.686124Z"
    }
  }
```

The revocation status endpoint will also be updated to the new state.

```http
GET /v1/issuer/credentials/revocation/record?credential_exchange_id=v2-af4bad3f-3fcc-47ab-85e6-24224dcb2779'
```

```json
{
  "created_at": "2024-04-30T08:51:18.177543Z",
  "cred_def_id": "QrMaE11MnC6zjKNY1pxbq8:3:CL:8:Epic",
  "cred_ex_id": "af4bad3f-3fcc-47ab-85e6-24224dcb2779",
  "cred_ex_version": "2",
  "cred_rev_id": "2",
  "record_id": "57bd9c72-fa29-4f65-bd89-4e241471073a",
  "rev_reg_id": "QrMaE11MnC6zjKNY1pxbq8:4:QrMaE11MnC6zjKNY1pxbq8:3:CL:8:Epic:CL_ACCUM:53462552-d716-4b0b-8b5c-914a3574d2c4",
  "state": "revoked",
  "updated_at": "2024-04-30T12:21:16.686124Z"
}
```

However every credential revoked like this will fire off a ledger operation which has a cost associated with it. If an issuer has more than one credential to revoke it is recommended to not auto publish to the ledger.

## Auto publish false (batching)

By setting the ```"auto_publish_on_ledger"``` to *false* an issuer can call revoke on all the *credential exchange ids* they would like to revoke without doing multiple ledger operations.

```http
POST /v1/issuer/credentials/revoke
```

```json
{
  "credential_exchange_id": "v2-6dbfbeeb-468f-4017-93f7-09c3602b15d4",
  "credential_definition_id": "QrMaE11MnC6zjKNY1pxbq8:3:CL:8:Epic",
  "auto_publish_on_ledger": false
}
```

The endpoint will respond with ``204`` status code

However the ```"issuer_cred_rev"``` event won't fire after every call like with ```"auto_publish_on_ledger": true``` because the credential's status will only update when the revocation has been published to the ledger.
This is also reflected in the revocation record as the state is still *issued*.

```http
GET /v1/issuer/credentials/revocation/record?credential_exchange_id=v2-6dbfbeeb-468f-4017-93f7-09c3602b15d4'
```

```json
{
  "created_at": "2024-04-30T12:49:25.210664Z",
  "cred_def_id": "QrMaE11MnC6zjKNY1pxbq8:3:CL:8:Epic",
  "cred_ex_id": "6dbfbeeb-468f-4017-93f7-09c3602b15d4",
  "cred_ex_version": "2",
  "cred_rev_id": "3",
  "record_id": "287a40fe-a23e-4675-b21f-5b72835b25be",
  "rev_reg_id": "QrMaE11MnC6zjKNY1pxbq8:4:QrMaE11MnC6zjKNY1pxbq8:3:CL:8:Epic:CL_ACCUM:53462552-d716-4b0b-8b5c-914a3574d2c4",
  "state": "issued",
  "updated_at": "2024-04-30T12:49:25.210664Z"
}
```

Once revoked is called on all the *credential exchange ids* that need to be revoked, then the revocations can be published to the ledger.

[Publishing revocations will be discussed here](./4.%20Publish%20Revocations.md)
