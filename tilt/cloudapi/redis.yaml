# https://github.com/bitnami/charts/tree/main/bitnami/redis-cluster
fullnameOverride: redis

redis:
  podAnnotations:
    sidecar.istio.io/proxyCPU: 10m
  # podLabels:
  #   sidecar.istio.io/inject: "false"
  # https://github.com/bitnami/charts/blob/main/bitnami/common/templates/_resources.tpl#L15
  resourcesPreset: none

  lifecycleHooks:
    postStart:
      exec:
        command:
          - /bin/sh
          - -c
          - |-
            until redis-cli -h localhost -p 6379 ping; do
              echo "Waiting for Redis to be ready..."
              sleep 1
            done
            redis-cli CLUSTER RESET
            redis-cli CLUSTER SET-CONFIG-EPOCH 1
            redis-cli CLUSTER ADDSLOTS $(seq 0 16383)

cluster:
  nodes: 1
  replicas: 0

password: redis

tls:
  enabled: false
  autoGenerated: true # use self signed cert
  authClients: false # do not require clients to auth with certs

persistentVolumeClaimRetentionPolicy:
  enabled: true
  whenDeleted: Delete
