name: Lint/Format

on:
  workflow_call:
    inputs:
      mise-version:
        required: true
        type: string

permissions: {}

jobs:
  format:
    name: Format
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # v4.2.2
        with:
          persist-credentials: false

      - name: Overwrite .mise.toml # It's not needed in this workflow
        run: |
          cat <<EOF > .mise.toml
          [tools]
          "pipx:black" = "25.1"
          "pipx:isort" = "6.0"
          python = "3.12"
          EOF

      - name: Set up Mise
        uses: jdx/mise-action@c94f0bf9e520b150e34c017db785461f7e71c5fb # v2.2.2
        with:
          version: ${{ inputs.mise-version }}
          cache: true
          experimental: true
          install: true

      - name: Check import style with isort
        run: isort . --check --profile black --diff

      - name: Check code style with Black
        run: black . --check --diff

      - name: Check Tiltfiles with Black
        run: |
          find . -type f -name "Tiltfile" | while read -r file; do
            black --check --diff "$file"
          done
